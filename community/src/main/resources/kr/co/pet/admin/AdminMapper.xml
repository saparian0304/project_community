<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.pet.admin.AdminMapper">
	
	<select id="list" parameterType="kr.co.pet.admin.AdminBoardVO" resultType="kr.co.pet.admin.AdminBoardVO">
		SELECT 
			board.board_no,	board_name,	horse_hair,	title, board.member_no, viewcount,	
			content, tel, link, board.regdate, update_date, isdelete,	
			loc_no,	gps_x, gps_y, location.addr, addr2,		
			hos_no,	license_no,	hospital.park, hospital.ani_type, hurry, room,
			cent_no, shelter_no, center.park, center.ani_type,
			(SELECT COUNT(*) FROM file WHERE board.board_no = file.board_no) file_count,
			nickname AS memb_nickname
		FROM board left join location 
			ON board.board_no = location.board_no
			LEFT JOIN hospital
			ON board.board_no = hospital.board_no
			LEFT JOIN center
			ON board.board_no = center.board_no
			LEFT JOIN member
			ON board.member_no = member.member_no
		<where>
			<if test="sword != null and sword != ''">
				<if test="stype == 'all'">
					(title LIKE '%${sword}%' OR content LIKE '%${sword}%' )
				</if>
				<if test="stype == 'title'">
					title LIKE '%${sword}%'
				</if>
				<if test="stype == 'content'">
					content LIKE '%${sword}%'
				</if>
			</if>
			<if test="nickname != null and nickname != ''">
				and nickname = #{nickname}
			</if>
		</where>
		ORDER BY regdate DESC
		Limit #{startIdx},${pageRow}
	</select>
	
	<select id="count" resultType="int">
		SELECT count(*)
		FROM board left join location 
			ON board.board_no = location.board_no
			LEFT JOIN hospital
			ON board.board_no = hospital.board_no
			LEFT JOIN center
			ON board.board_no = center.board_no
		<where>
			<if test="sword != null or sword != ''">
				<if test="stype == 'all'">
					title LIKE '%${sword}%' OR content LIKE '%${sword}%' 
				</if>
				<if test="stype == 'title'">
					title LIKE '%${sword}%'
				</if>
				<if test="stype == 'content'">
					content LIKE '%${sword}%'
				</if>
			</if>
		</where>
		ORDER BY regdate DESC
	</select>
</mapper>